---
import Default from "../../layouts/Default.astro";
import DrinkPage from "../../components/browse/DrinkPage.astro";
import Unauthorized from "../../components/browse/Unauthorized.astro";

export const prerender = false;

const { id } = Astro.params;

let drinksData: JSON;
let alcoholAllowed;

try {
	drinksData = await fetch(`${import.meta.env.PUBLIC_API_URL}/drinks/${id}`, {
		method: "GET",
	})
		.then((response) => response.json())
		.then((data) => {
			const abv = data.abv;
			if (abv === 0 || abv === null) {
				return data;
			}
			if (Astro.url.hostname.split(".")[0] === "syppi") {
				throw new Error("Not allowed");
			}
			alcoholAllowed = true;
			return data;
		});
} catch (error) {
	drinksData = {};
	alcoholAllowed = false;
}
---

<Default title={` - ${drinksData.name}`}>
	{alcoholAllowed && <DrinkPage data={drinksData}></DrinkPage>}
	{!alcoholAllowed && <Unauthorized></Unauthorized>}
</Default>