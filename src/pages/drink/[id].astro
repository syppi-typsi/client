---
import Default from "../../layouts/Default.astro";
import DrinkPage from "../../components/browse/DrinkPage.astro";

export const prerender = false;

const { id } = Astro.params;

let drinksData: JSON;

try {
	drinksData = await fetch(`${import.meta.env.PUBLIC_API_URL}/drinks/${id}`, {
		method: "GET",
	})
		.then((response) => response.json())
		.then((data) => {
			const abv = data.abv;
			if (abv === 0 || abv === null) {
				return data;
			}
			if (Astro.url.hostname.split(".")[0] === "syppi") {
				throw new Error("Not allowed");
			}
			return data;
		});
} catch (error) {
	return Astro.redirect("/oops");
}
---

<Default title={` - ${drinksData.name}`}>
	<DrinkPage data={drinksData}></DrinkPage>
</Default>